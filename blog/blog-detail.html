<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sage | Blog</title>
    <link rel="stylesheet" href="../css/main.desktop.css" />
    <link rel="shortcut icon" href="../assets/logo.png" type="image/png" />
    <link
      rel="stylesheet"
      media="screen and (max-width: 720px)"
      href="../css/main.mobile.css"
    />
    <script
      src="https://kit.fontawesome.com/891622f836.js"
      crossorigin="anonymous"
    ></script>
  </head>

  <body>
    <div id="loading-wrapper">
      <div id="loader"></div>
    </div>
    <main class="main-container">
      <nav class="nav-container">
        <div class="nav-top">
          <div class="nav-logo">
            <img src="../assets/logo.png" alt="logo" />
            <div>
              <p>sage</p>
              <p>ishimwe</p>
            </div>
          </div>
          <div class="nav-hamburger">
            <svg
              width="24"
              height="24"
              xmlns="http://www.w3.org/2000/svg"
              fill-rule="evenodd"
              clip-rule="evenodd"
            >
              <path d="M0 0h24v24H0z" fill="none" />
              <path
                d="M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h18v2H3v-2z"
                fill="#000"
              />
            </svg>
          </div>
        </div>

        <ul class="nav-links">
          <li><a href="../index.html">Home</a></li>
          <li><a href="../index.html#about">About</a></li>
          <li><a href="../index.html#service">Services</a></li>
          <li><a href="./blog.html">Blog</a></li>
          <li><a href="../index.html#portfolio">Portfolio</a></li>
          <li><a href="../index.html#contact">Contact</a></li>
          <button class="nav-btn">Get a Quote</button>
        </ul>
      </nav>
    </main>

    <main class="main-container">
      <div class="blog-image">
        <img src="../assets/blog1.jpg" alt="blog header" />
      </div>
      <section class="blog-head">
        <article>
          <h1 class="blog-title">
            Software Engineer vs Software <br />
            Developer as a senior
          </h1>
          <h6><span>By Sage Ishimwe</span> | <span>May 20, 2024</span></h6>
        </article>
        <div class="blog-reactions">
          <div id="likee" class="blog-reaction">
            <i class="fa fa-lg fa-thumbs-up"></i>
            <p>100</p>
          </div>
          <div class="blog-reaction">
            <i class="fa fa-lg fa-thumbs-down"></i>
            <p>10</p>
          </div>
          <div class="blog-reaction">
            <i class="fa fa-lg fa-comments"></i>
            <p>20</p>
          </div>
        </div>
      </section>
      <hr />
      <div class="blog-description"></div>
      <section class="comments">
        <h3>Comments</h3>
        <!-- <div class="comment">
          <div class="comment-user">
            <img src="../assets/logo.png" alt="user" />
            <div>
              <h5>John Doe</h5>
              <p>May 20, 2025</p>
            </div>
            <div class="reply">
              <img
                height="10px"
                width="10px"
                src="../assets/reply.svg"
                alt="reply"
              />
              <a href="#">Reply</a>
            </div>
          </div>
          <p>this is a comment</p>
        </div> -->
        <div id="comments"></div>
        <div class="leave-comment">
          <h1>Leave a Comment</h1>
          <textarea
            cols="15"
            id="comment-text"
            placeholder="Write Comment"
          ></textarea>
          <button id="comment-btn">Comment</button>
        </div>
      </section>
    </main>
    <footer>
      <div class="footer-container">
        <div class="footer-logo">
          <div class="s-logo">
            <span>S</span>
          </div>
          <div>
            <p>ishimwe sage</p>
            <p>Software Developer</p>
          </div>
        </div>

        <ul class="footer-links">
          <li><a href="#">Home</a></li>
          <li><a href="#">About</a></li>
          <li><a href="#">Services</a></li>
          <li><a href="./blog/blog.html">Blog</a></li>
          <li><a href="#">Portfolio</a></li>
          <li><a href="#">Contact</a></li>
        </ul>

        <div class="footer-socials">
          <a href="#" target="_blank"
            ><i class="fa fa-lg fa-brands fa-github"></i
          ></a>
          <a href="#" target="_blank">
            <i class="fa fa-lg fa-brands fa-twitter"></i>
          </a>
          <a href="http://" target="_blank" rel="noopener noreferrer">
            <i class="fa fa-lg fa-brands fa-linkedin"></i>
          </a>
          <a href="http://" target="_blank" rel="noopener noreferrer">
            <i class="fa fa-lg fa-brands fa-figma"></i>
          </a>
          <a href="http://" target="_blank" rel="noopener noreferrer">
            <i class="fa fa-lg fa-brands fa-instagram"></i>
          </a>
          <a href="http://" target="_blank" rel="noopener noreferrer">
            <i class="fa fa-lg fa-brands fa-pinterest-p"></i>
          </a>
        </div>
      </div>
      <hr />
      <div class="footer-credits">
        <p>&copy; 2024 Sage Ishimwe</p>
        <p style="font-size: 12px">Designed and Developed by Sage Ishimwe</p>
      </div>
    </footer>
    <script>
      window.addEventListener("load", () => {
        const loader = document.getElementById("loader");
        loader.style.opacity = 0;
        loader.style.display = "none";
      });
      const urlParams = new URLSearchParams(window.location.search);
      const blogId = urlParams.get("blogId");
      console.log("blog id", blogId);
      const blogs = JSON.parse(localStorage.getItem("blogs"));
      const blog = blogs.find((b) => b.uuid === blogId);
      console.log("blog", blog);
      if (blog === undefined) {
        window.location.href = "./blog.html";
      }
      const blogImage = document.querySelector(".blog-image img");
      const blogTitle = document.querySelector(".blog-title");
      const blogAuthor = document.querySelector(".blog-head span:first-child");
      const blogDate = document.querySelector(".blog-head span:last-child");
      const blogLikes = document.querySelector(".blog-reaction:first-child p");
      const blogDislikes = document.querySelector(
        ".blog-reaction:nth-child(2) p"
      );
      const blogComments = document.querySelector(
        ".blog-reaction:last-child p"
      );
      const blogDescription = document.querySelector(".blog-description");
      blogImage.src = blog.image;
      blogTitle.textContent = blog.title;
      blogAuthor.textContent = "By " + blog.author || "sage";
      blogDate.textContent = blog.createdAt;
      blogDescription.innerHTML = blog.content;
      blogLikes.textContent = blog.likes.length || 0;
      blogDislikes.textContent = 0; // Set the dislikes text to the number of dislikes
      blogComments.textContent = blog.comments.length || 0; // Set the comments text to the number of comments
      document
        .getElementById("comment-btn")
        .addEventListener("mouseover", (event) => {
          //check if user is logged in by checking if the user is in the local storage auth
          if (!localStorage.getItem("auth")) {
            console.log("user is not logged in");
            alert("You need to login to comment");
            window.location.href = "../auth/login.html";
          }

          let loginUser = JSON.parse(localStorage.getItem("auth"));

          event.preventDefault();
          console.log("comment button clicked");
          const commentText = document.getElementById("comment-text").value;
          let formattedDate = new Date().toLocaleDateString("en-US", {
            year: "numeric",
            month: "long",
            day: "numeric",
          });
          const newComment = {
            id: generateUniqueId(),
            text: commentText,
            name: loginUser.fullName || "Anonymous",
            timestamp: formattedDate,
          };
          // blog.comments.push(newComment);
          console.log(newComment);
          saveBlogDataToLocalStorage(newComment);
          document.getElementById("comment-text").value = "";
          // ... (display success message)
          alert("Comment added successfully");
        });
      function saveBlogDataToLocalStorage(newComment) {
        const blogs = JSON.parse(localStorage.getItem("blogs") || "[]");

        // Find the correct blog object using its unique identifier
        const blogIndex = blogs.findIndex((b) => b.uuid === blogId);
        console.log(blogIndex, "blog index");
        if (blogIndex !== -1) {
          // Update comments only if blog found
          // Update the comments array within the existing blog object

          blogs[blogIndex].comments.push(newComment);
        }

        localStorage.setItem("blogs", JSON.stringify(blogs));
      }
      function generateUniqueId() {
        return Math.random().toString(36).substr(2, 9);
      }

      function saveLike(like) {
        const blogs = JSON.parse(localStorage.getItem("blogs") || "[]");
        const blogIndex = blogs.findIndex((b) => b.uuid === blogId);
        if (blogIndex !== -1) {
          // if already liked then remove like from it
          const alreadyLiked = blogs[blogIndex].likes.find(
            (l) => l.name === like.name
          );
          if (alreadyLiked) {
            blogs[blogIndex].likes = blogs[blogIndex].likes.filter(
              (l) => l.name !== like.name
            );
          } else {
            blogs[blogIndex].likes.push(like);
          }
        }
        localStorage.setItem("blogs", JSON.stringify(blogs));
      }
      document.getElementById("likee").addEventListener("click", (event) => {
        event.preventDefault();
        console.log("like button clicked");
        const like = {
          id: generateUniqueId(),
          name: "sage",
          timestamp: new Date().toLocaleDateString("en-US", {
            year: "numeric",
            month: "long",
            day: "numeric",
          }),
        };
        saveLike(like);
        // ... (display success message)
        alert("Liked successfully");
      });

      function ShowComment(blog) {
        blog.comments.forEach((comment) => {
          const commentDiv = document.createElement("div");
          commentDiv.classList.add("comment");
          commentDiv.innerHTML = `
          <div class="comment-user">
            <img src="../assets/logo.png" alt="user" />
            <div>
              <h5>${comment.name}</h5>
              <p>${comment.timestamp}</p>
            </div>
            <div class="reply">
              <img
                height="10px"
                width="10px"
                src="../assets/reply.svg"
                alt="reply"
              />
              <a href="#">Reply</a>
            </div>
          </div>
          <p>${comment.text}</p>
        `;
          document.getElementById("comments").appendChild(commentDiv);
        });
      }
      ShowComment(blog);
      // Load visited blogs and total visits from localStorage or initialize them
      const visitedBlogs = localStorage.getItem("visitedBlogs")
        ? JSON.parse(localStorage.getItem("visitedBlogs"))
        : [];
      let totalVisits = parseInt(localStorage.getItem("totalVisits")) || 0;

      // Find the relevant blog object based on `blogId` from the URL

      // Check if the blog has been visited before
      const isVisited = visitedBlogs.includes(blogId);
      totalVisits++;
      localStorage.setItem("totalVisits", totalVisits.toString());

      // Update the visited blogs array and total visits (if a new blog is visited)
      if (!isVisited) {
        visitedBlogs.push(blogId);
        localStorage.setItem("visitedBlogs", JSON.stringify(visitedBlogs));
      }

      // Update UI elements
      
    </script>
  </body>
</html>
